import streamlit as st
import google.generativeai as genai

# ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä‡∑ö ‡∑É‡∑ê‡∂ö‡∑É‡∑î‡∂∏‡∑ä
st.set_page_config(page_title="AI ‡∂¥‡∑è‡∂Ω‡∑í ‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂ö‡∂∫", page_icon="‚ò∏Ô∏è")

def get_working_model():
    """‡∂î‡∂∂‡∑ö API Key ‡∂ë‡∂ö‡∂ß ‡∑É‡∑Ñ‡∂∫ ‡∂Ø‡∂ö‡∑ä‡∑Ä‡∂± ‡∂¥‡∑Ä‡∂≠‡∑í‡∂± ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫‡∂ö‡∑ä ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫‡∑Ä ‡∑É‡∑ú‡∂∫‡∑è ‡∂Ø‡∑ô‡∂∫‡∑í"""
    try:
        # ‡∂¥‡∑Ä‡∂≠‡∑í‡∂± ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂∫‡∑í
        available_models = [m.name for m in genai.list_models() if 'generateContent' in m.supported_generation_methods]
        
        # ‡∂Ö‡∂¥‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑î‡∂õ‡∂≠‡∑è‡∑Ä‡∂∫ ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂∫‡∑í
        # ‡∂∏‡∑ô‡∑Ñ‡∑í‡∂Ø‡∑ì models/gemini-1.5-flash ‡∑Ñ‡∑ù models/gemini-pro ‡∑Ä‡∑ê‡∂±‡∑í ‡∂ï‡∂±‡∑ë‡∂∏ ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∑è‡∂ú‡∂±‡∑ì
        for preferred in ['models/gemini-1.5-flash', 'models/gemini-1.5-flash-latest', 'models/gemini-pro']:
            if preferred in available_models:
                return preferred
        
        # ‡∂â‡∑Ñ‡∂≠ ‡∂ö‡∑í‡∑É‡∑í‡∑Ä‡∂ö‡∑ä ‡∂±‡∑ê‡∂≠‡∑ä‡∂±‡∂∏‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑í‡∂± ‡∂¥‡∑Ö‡∂∏‡∑î ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫ ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂∫‡∑í
        return available_models[0] if available_models else None
    except:
        return None

# --- API ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä ‡∑É‡∑Ñ ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∂≠‡∑è‡∑Ä‡∂∫ ---
try:
    if "GEMINI_API_KEY" in st.secrets:
        API_KEY = st.secrets["GEMINI_API_KEY"]
        genai.configure(api_key=API_KEY)
        
        # ‡∑Ä‡∑ê‡∂© ‡∂ö‡∂ª‡∂± ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫‡∂ö‡∑ä ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫‡∑Ä ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
        working_model_id = get_working_model()
        
        if working_model_id:
            model = genai.GenerativeModel(working_model_id)
            # st.info(f"‡∑É‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫ ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫: {working_model_id}") # ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∂±‡∂∏‡∑ä ‡∂∏‡∑ô‡∂∫ ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö
        else:
            st.error("‡∂î‡∂∂‡∑ö API Key ‡∂ë‡∂ö ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂ö‡∑í‡∑É‡∑í‡∂Ø‡∑î ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫‡∂ö‡∑ä ‡∑Ñ‡∂∏‡∑î ‡∂±‡∑ú‡∑Ä‡∑ì‡∂∫.")
    else:
        st.error("GEMINI_API_KEY ‡∂ª‡∑Ñ‡∑É‡∑ä ‡∂¥‡∂Ø‡∂∫ (Secret) ‡∑Ñ‡∂∏‡∑î ‡∂±‡∑ú‡∑Ä‡∑ì‡∂∫.")
except Exception as e:
    st.error(f"‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î ‡∑Ä‡∑í‡∂∫: {e}")

st.title("‚ò∏Ô∏è AI ‡∂¥‡∑è‡∂Ω‡∑í ‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂ö‡∂∫")
st.markdown("---")

pali_text = st.text_area("‡∂¥‡∑è‡∂Ω‡∑í ‡∑Ä‡∑è‡∂ö‡∑ä‚Äç‡∂∫‡∂∫ ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:", placeholder="‡∂ã‡∂Ø‡∑è: Sabbe satta bhavantu sukhitatta")

if st.button("‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±"):
    if pali_text:
        with st.spinner('‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...'):
            try:
                prompt = f"As a Pali scholar, translate this to Sinhala and English with word meanings: {pali_text}"
                response = model.generate_content(prompt)
                st.markdown("### üìù ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω‡∂∫:")
                st.write(response.text)
            except Exception as e:
                st.error(f"‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂Ö‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö ‡∑Ä‡∑í‡∂∫: {e}")
    else:
        st.warning("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂¥‡∑è‡∂Ω‡∑í ‡∑Ä‡∑è‡∂ö‡∑ä‚Äç‡∂∫‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.")
