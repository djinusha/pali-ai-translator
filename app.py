import streamlit as st
import google.generativeai as genai

# ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä‡∑ö ‡∑É‡∑ê‡∂ö‡∑É‡∑î‡∂∏‡∑ä (Page Config)
st.set_page_config(
    page_title="AI ‡∂¥‡∑è‡∂Ω‡∑í ‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂ö‡∂∫", 
    page_icon="‚ò∏Ô∏è",
    layout="centered"
)

# --- API ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä ‡∑É‡∑Ñ ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∂≠‡∑è‡∑Ä‡∂∫ ---
try:
    # ‡∂î‡∂∂‡∑ö API Key ‡∂ë‡∂ö Streamlit Secrets ‡∂∏‡∂ú‡∑í‡∂±‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂ú‡∂±‡∑ì
    # ‡∂∏‡∑ô‡∂∫ GitHub ‡∂ë‡∂ö‡∑ö ‡∂¥‡∑ô‡∂±‡∑ô‡∂±‡∑ä‡∂±‡∂ß ‡∂±‡∑ê‡∂≠‡∑í ‡∂±‡∑í‡∑É‡∑è ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑í‡∂≠‡∂∫‡∑í
    if "GEMINI_API_KEY" in st.secrets:
        API_KEY = st.secrets["GEMINI_API_KEY"]
        genai.configure(api_key=API_KEY)
        
        # ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫‡∂ß ‡∂ú‡∑ê‡∂Ω‡∂¥‡∑ô‡∂± ‡∑Ñ‡∑ú‡∂≥‡∂∏ Model ‡∂ë‡∂ö ‡∂≠‡∑ù‡∂ª‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
        model = genai.GenerativeModel('gemini-1.5-flash')
    else:
        st.error("‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑í: GEMINI_API_KEY ‡∂∫‡∂±‡∑ä‡∂± Secrets ‡∑Ñ‡∑í ‡∑Ñ‡∂∏‡∑î ‡∂±‡∑ú‡∑Ä‡∑ì‡∂∫.")
except Exception as e:
    st.error(f"‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫ ‡∂¥‡∂´ ‡∂ú‡∑ê‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î ‡∑Ä‡∑í‡∂∫: {e}")

# --- ‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö ‡∂∏‡∑î‡∑Ñ‡∑î‡∂´‡∂≠ (User Interface) ---
st.title("‚ò∏Ô∏è AI ‡∂¥‡∑è‡∂Ω‡∑í ‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂ö‡∂∫")
st.subheader("‡∂¥‡∑è‡∂Ω‡∑í ‡∂¥‡∑è‡∂® ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω ‡∑É‡∑Ñ ‡∂â‡∂Ç‡∂ú‡∑ä‚Äç‡∂ª‡∑ì‡∑É‡∑í ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä‡∂ß ‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±")
st.markdown("---")

# ‡∂¥‡∑è‡∂Ω‡∑í ‡∑Ä‡∑è‡∂ö‡∑ä‚Äç‡∂∫‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂± ‡∂ö‡∑ú‡∂ß‡∑î‡∑Ä
pali_text = st.text_area(
    "‡∂¥‡∑è‡∂Ω‡∑í ‡∑Ä‡∑è‡∂ö‡∑ä‚Äç‡∂∫‡∂∫ ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:", 
    placeholder="‡∂ã‡∂Ø‡∑è: Sabbe satta bhavantu sukhitatta",
    height=150
)

# ‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂∂‡∑ú‡∂≠‡∑ä‡∂≠‡∂∏
if st.button("‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±"):
    if pali_text:
        with st.spinner('AI ‡∂∏‡∂ú‡∑í‡∂±‡∑ä ‡∂Ö‡∂ª‡∑ä‡∂Æ ‡∑Ä‡∑í‡∑Å‡∑ä‡∂Ω‡∑ö‡∑Ç‡∂´‡∂∫ ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...'):
            try:
                # AI ‡∂ë‡∂ö‡∂ß ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂± ‡∂ã‡∂¥‡∂Ø‡∑ô‡∑É‡∑ä (Prompt)
                prompt = (
                    f"You are a Pali language scholar. Translate the following text into "
                    f"clear Sinhala and English. Also, provide a word-by-word breakdown table.\n\n"
                    f"Pali Text: {pali_text}"
                )
                
                # ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω‡∂∫ ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
                response = model.generate_content(prompt)
                
                # ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω‡∂∫ ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∂ª‡∑ä‡∑Å‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                st.markdown("### üìù ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω‡∂∫:")
                st.success("‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í!")
                st.markdown(response.text)
                
            except Exception as e:
                st.error("‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂∂‡∑è‡∂∞‡∑è‡∑Ä‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂∫.")
                st.info(f"‡∂≠‡∑è‡∂ö‡∑ä‡∑Ç‡∂´‡∑í‡∂ö ‡∂Ø‡∑ù‡∑Ç‡∂∫: {e}")
    else:
        st.warning("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂¥‡∑è‡∂Ω‡∑í ‡∑Ä‡∑è‡∂ö‡∑ä‚Äç‡∂∫‡∂∫‡∂ö‡∑ä ‡∑Ñ‡∑ù ‡∂¥‡∑è‡∂®‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.")

# ‡∂¥‡∑è‡∂Ø‡∂ö ‡∑É‡∂ß‡∑Ñ‡∂±
st.markdown("---")
st.caption("‡∂∏‡∑ô‡∂∏ ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫ Google Gemini AI ‡∂≠‡∑è‡∂ö‡∑ä‡∑Ç‡∂´‡∂∫‡∑ô‡∂±‡∑ä ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∑Ä‡∂± ‡∂Ö‡∂≠‡∂ª, ‡∂ë‡∂∫ ‡∂î‡∂∂‡∂ú‡∑ö API Key ‡∂ë‡∂ö ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑í‡∂≠‡∑Ä ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂∫‡∑í.")
